/* Export all Sysreptor vulnerability templates.
 *
 * First, go to /templates/, then run this script.
 *
 * If you don't want 1 download window per file do this:
 * 1. Browser > Settings > Downloads
 * 2. Choose a save location
 * 3. Uncheck "Always ask you where to save files"
 */
function export_all() {
  const vulns = document.getElementsByClassName('v-list-item--link');
  for (const vuln of vulns) {
    const uuid = vuln.href.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/)[0];
    const export_link = `/api/v1/findingtemplates/${uuid}/export/`;
    fetch(export_link, {method: "POST", body: "{}", headers: {"Content-Type": "application/json"}})
      .then( res => res.blob() )
      .then( blob => {
        var fileURL = URL.createObjectURL(blob);
        var fileLink = document.createElement('a');
        fileLink.href = fileURL;
        fileLink.download = `${uuid}.tar.gz`;
        fileLink.click();
      });
  }
}
export_all();
